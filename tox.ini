[tox]
envlist =
    py{311,312,313}-dj{42,50,51}{,-postgres,-mysql}
    py314-dj{50,51}{,-postgres,-mysql}
    lint
    docs
skip_missing_interpreters = True
requires =
    tox-uv>=1.0

[gh-actions]
python =
    3.11: py311
    3.12: py312, lint, docs
    3.13: py313
    3.14: py314

[testenv]
passenv =
    CI
    COVERAGE
    RUNTEST_ARGS
    GITHUB_*
    DATABASE_URL
runner = uv-venv-lock-runner
commands =
    coverage run --parallel-mode manage.py test {env:RUNTEST_ARGS:-v 2 --noinput}
    coverage combine
    coverage xml
deps =
    coverage>=7.0
    django-environ
    dj42: Django>=4.2,<4.3
    dj50: Django>=5.0,<5.1
    dj51: Django>=5.1,<5.2
    postgres: psycopg2-binary
    mysql: mysqlclient
setenv =
    DATABASE_URL = sqlite:////tmp/test.db
    postgres: DATABASE_URL = postgres://postgres:postgres@localhost:5432/postgres
    mysql: DATABASE_URL = mysql://root:mysql@127.0.0.1:3306/mysql

[testenv:lint]
deps =
    ruff>=0.8.0
commands =
    ruff check .
    ruff format --check .

[testenv:docs]
changedir = docs
deps =
    sphinx>=7.0
    django-environ
    Django>=4.2
commands = sphinx-build -b html -d {envtmpdir}/doctrees . {envtmpdir}/html
